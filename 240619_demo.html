<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>物理演算デモ1</title>
    <script src="./js/Tiny2D.js"></script>
    <style>
        #canvas{
            width:600px;
            height:600px;
        }
    </style>
    <script>
        var engine, ctx;
        var colors = ["yellow", "green", "orange", "blue", "white"];

        function rand(v){
            return Math.floor(Math.random() * v);
        }

        function init(){
            var r;
            engine = new Engine(0, 0, 600, 800, 0, 9.8);
            //壁1
            r = new RectangleEntity(500, 50, 50, 400);
            r.color = colors[1];
            engine.entities.push(r);
            //壁2
            r = new RectangleEntity(0, 50, 50, 400);
            r.color = colors[0];
            engine.entities.push(r);
            //線1
            r = new LineEntity(50, 300, 400, 350);
            r.color = colors[2];
            engine.entities.push(r);
            //線2
            r = new LineEntity(500, 400, 100, 450);
            r.color = colors[2];
            engine.entities.push(r);

            //固定された円
            for (var i = 0; i < 7 ; i++) {
                for (var j = 0; j < 3 ; j++) {
                    r = new CircleEntity(i * 60 + 100, j * 60 + 100, 5, BodyStatic);
                    //(x座標 , y座標, 半径, オブジェクトモード)
                    r.color = colors[j];
                    engine.entities.push(r);
                }
            }
            //移動する円
            for (var i = 0; i < 200; i++) {
                r = new CircleEntity(rand(400)+50, rand(200), 2, BodyDynamic);//ランダムな位置に円を呼び出す
                r.color = colors[rand(5)];
                r.velocity.x = rand(10) - 5;
                r.velocity.y = rand(10) + 5;
                engine.entities.push(r);
            }

            ctx = document.getElementById("canvas").getContext("2d");
            setInterval(tick, 50);
        }
        //更新
        function tick(){
            engine.step(0.01);
            repaint();
        }
        //描画
        function repaint(){
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, 600, 600);
            for (var i = 0; i < engine.entities.length; i++) {
                var e = engine.entities[i];
                ctx.fillStyle = e.color;
                ctx.strokeStyle = e.color;
                switch (e.shape) {
                    //四角なら
                    case ShapeRectangle:
                        ctx.fillRect(e.x, e.y, e.w, e.h);
                        break;
                    //円なら
                    case ShapeCircle:
                        ctx.beginPath();
                        ctx.arc(e.x, e.y, e.radius, 0, Math.PI * 2);
                        ctx.closePath();
                        ctx.fill();
                        break;
                    //線なら
                    case ShapeLine:
                        ctx.beginPath();
                        ctx.moveTo(e.x0, e.y0);
                        ctx.lineTo(e.x1, e.y1);
                        ctx.stroke();
                        break;
                }
            }
        }
    </script>
</head>
<body onload="init()">
    <canvas id="canvas" width="600" height="600"></canvas>
</body>
</html>